{"dependencies":[{"name":"../utils.web","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":61},"end":{"line":2,"column":42,"index":103}}],"key":"V6Cd8v/K/LtdxP2wf1WD5HCNhqM=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _utilsWeb = require(_dependencyMap[0], \"../utils.web\");\n  /**\n   * Hermite resize - fast image resize/resample using Hermite filter. 1 cpu version!\n   * https://stackoverflow.com/a/18320662/4047926\n   *\n   * @param {HTMLCanvasElement} canvas\n   * @param {int} width\n   * @param {int} height\n   * @param {boolean} resizeCanvas if true, canvas will be resized. Optional.\n   */\n  function resampleSingle(canvas, width, height, resizeCanvas = false) {\n    const result = document.createElement('canvas');\n    result.width = canvas.width;\n    result.height = canvas.height;\n    const widthSource = canvas.width;\n    const heightSource = canvas.height;\n    width = Math.round(width);\n    height = Math.round(height);\n    const wRatio = widthSource / width;\n    const hRatio = heightSource / height;\n    const wRatioHalf = Math.ceil(wRatio / 2);\n    const hRatioHalf = Math.ceil(hRatio / 2);\n    const ctx = (0, _utilsWeb.getContext)(canvas);\n    const img = ctx.getImageData(0, 0, widthSource, heightSource);\n    const img2 = ctx.createImageData(width, height);\n    const data = img.data;\n    const data2 = img2.data;\n    for (let j = 0; j < height; j++) {\n      for (let i = 0; i < width; i++) {\n        const x2 = (i + j * width) * 4;\n        let weight = 0;\n        let weights = 0;\n        let weightsAlpha = 0;\n        let gx_r = 0;\n        let gx_g = 0;\n        let gx_b = 0;\n        let gx_a = 0;\n        const yCenter = (j + 0.5) * hRatio;\n        const yy_start = Math.floor(j * hRatio);\n        const yy_stop = Math.ceil((j + 1) * hRatio);\n        for (let yy = yy_start; yy < yy_stop; yy++) {\n          const dy = Math.abs(yCenter - (yy + 0.5)) / hRatioHalf;\n          const center_x = (i + 0.5) * wRatio;\n          const w0 = dy * dy; //pre-calc part of w\n          const xx_start = Math.floor(i * wRatio);\n          const xx_stop = Math.ceil((i + 1) * wRatio);\n          for (let xx = xx_start; xx < xx_stop; xx++) {\n            const dx = Math.abs(center_x - (xx + 0.5)) / wRatioHalf;\n            const w = Math.sqrt(w0 + dx * dx);\n            if (w >= 1) {\n              //pixel too far\n              continue;\n            }\n            //hermite filter\n            weight = 2 * w * w * w - 3 * w * w + 1;\n            const xPosition = 4 * (xx + yy * widthSource);\n            //alpha\n            gx_a += weight * data[xPosition + 3];\n            weightsAlpha += weight;\n            //colors\n            if (data[xPosition + 3] < 255) {\n              weight = weight * data[xPosition + 3] / 250;\n            }\n            gx_r += weight * data[xPosition];\n            gx_g += weight * data[xPosition + 1];\n            gx_b += weight * data[xPosition + 2];\n            weights += weight;\n          }\n        }\n        data2[x2] = gx_r / weights;\n        data2[x2 + 1] = gx_g / weights;\n        data2[x2 + 2] = gx_b / weights;\n        data2[x2 + 3] = gx_a / weightsAlpha;\n      }\n    }\n\n    //resize canvas\n    if (resizeCanvas) {\n      result.width = width;\n      result.height = height;\n    }\n\n    //draw\n    const context = (0, _utilsWeb.getContext)(result);\n    context.putImageData(img2, 0, 0);\n    return result;\n  }\n  var _default = (canvas, {\n    width,\n    height\n  }) => {\n    const imageRatio = canvas.width / canvas.height;\n    let requestedWidth = 0;\n    let requestedHeight = 0;\n    if (width !== undefined) {\n      requestedWidth = width;\n      requestedHeight = requestedWidth / imageRatio;\n    }\n    if (height !== undefined) {\n      requestedHeight = height;\n      if (requestedWidth === 0) {\n        requestedWidth = requestedHeight * imageRatio;\n      }\n    }\n    return resampleSingle(canvas, requestedWidth, requestedHeight, true);\n  };\n});","lineCount":119,"map":[[7,2,102,0,"Object"],[7,8,102,0],[7,9,102,0,"defineProperty"],[7,23,102,0],[7,24,102,0,"exports"],[7,31,102,0],[8,4,102,0,"enumerable"],[8,14,102,0],[9,4,102,0,"get"],[9,7,102,0],[9,18,102,0,"get"],[9,19,102,0],[10,6,102,0],[10,13,102,0,"_default"],[10,21,102,0],[11,4,102,0],[12,2,102,0],[13,2,2,0],[13,6,2,0,"_utilsWeb"],[13,15,2,0],[13,18,2,0,"require"],[13,25,2,0],[13,26,2,0,"_dependencyMap"],[13,40,2,0],[14,2,4,0],[15,0,5,0],[16,0,6,0],[17,0,7,0],[18,0,8,0],[19,0,9,0],[20,0,10,0],[21,0,11,0],[22,0,12,0],[23,2,13,0],[23,11,13,9,"resampleSingle"],[23,25,13,23,"resampleSingle"],[23,26,14,2,"canvas"],[23,32,14,27],[23,34,15,2,"width"],[23,39,15,15],[23,41,16,2,"height"],[23,47,16,16],[23,49,17,2,"resizeCanvas"],[23,61,17,23],[23,64,17,26],[23,69,17,31],[23,71,18,21],[24,4,19,2],[24,10,19,8,"result"],[24,16,19,14],[24,19,19,17,"document"],[24,27,19,25],[24,28,19,26,"createElement"],[24,41,19,39],[24,42,19,40],[24,50,19,48],[24,51,19,49],[25,4,20,2,"result"],[25,10,20,8],[25,11,20,9,"width"],[25,16,20,14],[25,19,20,17,"canvas"],[25,25,20,23],[25,26,20,24,"width"],[25,31,20,29],[26,4,21,2,"result"],[26,10,21,8],[26,11,21,9,"height"],[26,17,21,15],[26,20,21,18,"canvas"],[26,26,21,24],[26,27,21,25,"height"],[26,33,21,31],[27,4,23,2],[27,10,23,8,"widthSource"],[27,21,23,19],[27,24,23,22,"canvas"],[27,30,23,28],[27,31,23,29,"width"],[27,36,23,34],[28,4,24,2],[28,10,24,8,"heightSource"],[28,22,24,20],[28,25,24,23,"canvas"],[28,31,24,29],[28,32,24,30,"height"],[28,38,24,36],[29,4,25,2,"width"],[29,9,25,7],[29,12,25,10,"Math"],[29,16,25,14],[29,17,25,15,"round"],[29,22,25,20],[29,23,25,21,"width"],[29,28,25,26],[29,29,25,27],[30,4,26,2,"height"],[30,10,26,8],[30,13,26,11,"Math"],[30,17,26,15],[30,18,26,16,"round"],[30,23,26,21],[30,24,26,22,"height"],[30,30,26,28],[30,31,26,29],[31,4,28,2],[31,10,28,8,"wRatio"],[31,16,28,14],[31,19,28,17,"widthSource"],[31,30,28,28],[31,33,28,31,"width"],[31,38,28,36],[32,4,29,2],[32,10,29,8,"hRatio"],[32,16,29,14],[32,19,29,17,"heightSource"],[32,31,29,29],[32,34,29,32,"height"],[32,40,29,38],[33,4,30,2],[33,10,30,8,"wRatioHalf"],[33,20,30,18],[33,23,30,21,"Math"],[33,27,30,25],[33,28,30,26,"ceil"],[33,32,30,30],[33,33,30,31,"wRatio"],[33,39,30,37],[33,42,30,40],[33,43,30,41],[33,44,30,42],[34,4,31,2],[34,10,31,8,"hRatioHalf"],[34,20,31,18],[34,23,31,21,"Math"],[34,27,31,25],[34,28,31,26,"ceil"],[34,32,31,30],[34,33,31,31,"hRatio"],[34,39,31,37],[34,42,31,40],[34,43,31,41],[34,44,31,42],[35,4,33,2],[35,10,33,8,"ctx"],[35,13,33,11],[35,16,33,14],[35,20,33,14,"getContext"],[35,29,33,24],[35,30,33,24,"getContext"],[35,40,33,24],[35,42,33,25,"canvas"],[35,48,33,31],[35,49,33,32],[36,4,35,2],[36,10,35,8,"img"],[36,13,35,11],[36,16,35,14,"ctx"],[36,19,35,17],[36,20,35,18,"getImageData"],[36,32,35,30],[36,33,35,31],[36,34,35,32],[36,36,35,34],[36,37,35,35],[36,39,35,37,"widthSource"],[36,50,35,48],[36,52,35,50,"heightSource"],[36,64,35,62],[36,65,35,63],[37,4,36,2],[37,10,36,8,"img2"],[37,14,36,12],[37,17,36,15,"ctx"],[37,20,36,18],[37,21,36,19,"createImageData"],[37,36,36,34],[37,37,36,35,"width"],[37,42,36,40],[37,44,36,42,"height"],[37,50,36,48],[37,51,36,49],[38,4,37,2],[38,10,37,8,"data"],[38,14,37,12],[38,17,37,15,"img"],[38,20,37,18],[38,21,37,19,"data"],[38,25,37,23],[39,4,38,2],[39,10,38,8,"data2"],[39,15,38,13],[39,18,38,16,"img2"],[39,22,38,20],[39,23,38,21,"data"],[39,27,38,25],[40,4,40,2],[40,9,40,7],[40,13,40,11,"j"],[40,14,40,12],[40,17,40,15],[40,18,40,16],[40,20,40,18,"j"],[40,21,40,19],[40,24,40,22,"height"],[40,30,40,28],[40,32,40,30,"j"],[40,33,40,31],[40,35,40,33],[40,37,40,35],[41,6,41,4],[41,11,41,9],[41,15,41,13,"i"],[41,16,41,14],[41,19,41,17],[41,20,41,18],[41,22,41,20,"i"],[41,23,41,21],[41,26,41,24,"width"],[41,31,41,29],[41,33,41,31,"i"],[41,34,41,32],[41,36,41,34],[41,38,41,36],[42,8,42,6],[42,14,42,12,"x2"],[42,16,42,14],[42,19,42,17],[42,20,42,18,"i"],[42,21,42,19],[42,24,42,22,"j"],[42,25,42,23],[42,28,42,26,"width"],[42,33,42,31],[42,37,42,35],[42,38,42,36],[43,8,43,6],[43,12,43,10,"weight"],[43,18,43,16],[43,21,43,19],[43,22,43,20],[44,8,44,6],[44,12,44,10,"weights"],[44,19,44,17],[44,22,44,20],[44,23,44,21],[45,8,45,6],[45,12,45,10,"weightsAlpha"],[45,24,45,22],[45,27,45,25],[45,28,45,26],[46,8,46,6],[46,12,46,10,"gx_r"],[46,16,46,14],[46,19,46,17],[46,20,46,18],[47,8,47,6],[47,12,47,10,"gx_g"],[47,16,47,14],[47,19,47,17],[47,20,47,18],[48,8,48,6],[48,12,48,10,"gx_b"],[48,16,48,14],[48,19,48,17],[48,20,48,18],[49,8,49,6],[49,12,49,10,"gx_a"],[49,16,49,14],[49,19,49,17],[49,20,49,18],[50,8,50,6],[50,14,50,12,"yCenter"],[50,21,50,19],[50,24,50,22],[50,25,50,23,"j"],[50,26,50,24],[50,29,50,27],[50,32,50,30],[50,36,50,34,"hRatio"],[50,42,50,40],[51,8,51,6],[51,14,51,12,"yy_start"],[51,22,51,20],[51,25,51,23,"Math"],[51,29,51,27],[51,30,51,28,"floor"],[51,35,51,33],[51,36,51,34,"j"],[51,37,51,35],[51,40,51,38,"hRatio"],[51,46,51,44],[51,47,51,45],[52,8,52,6],[52,14,52,12,"yy_stop"],[52,21,52,19],[52,24,52,22,"Math"],[52,28,52,26],[52,29,52,27,"ceil"],[52,33,52,31],[52,34,52,32],[52,35,52,33,"j"],[52,36,52,34],[52,39,52,37],[52,40,52,38],[52,44,52,42,"hRatio"],[52,50,52,48],[52,51,52,49],[53,8,53,6],[53,13,53,11],[53,17,53,15,"yy"],[53,19,53,17],[53,22,53,20,"yy_start"],[53,30,53,28],[53,32,53,30,"yy"],[53,34,53,32],[53,37,53,35,"yy_stop"],[53,44,53,42],[53,46,53,44,"yy"],[53,48,53,46],[53,50,53,48],[53,52,53,50],[54,10,54,8],[54,16,54,14,"dy"],[54,18,54,16],[54,21,54,19,"Math"],[54,25,54,23],[54,26,54,24,"abs"],[54,29,54,27],[54,30,54,28,"yCenter"],[54,37,54,35],[54,41,54,39,"yy"],[54,43,54,41],[54,46,54,44],[54,49,54,47],[54,50,54,48],[54,51,54,49],[54,54,54,52,"hRatioHalf"],[54,64,54,62],[55,10,55,8],[55,16,55,14,"center_x"],[55,24,55,22],[55,27,55,25],[55,28,55,26,"i"],[55,29,55,27],[55,32,55,30],[55,35,55,33],[55,39,55,37,"wRatio"],[55,45,55,43],[56,10,56,8],[56,16,56,14,"w0"],[56,18,56,16],[56,21,56,19,"dy"],[56,23,56,21],[56,26,56,24,"dy"],[56,28,56,26],[56,29,56,27],[56,30,56,28],[57,10,57,8],[57,16,57,14,"xx_start"],[57,24,57,22],[57,27,57,25,"Math"],[57,31,57,29],[57,32,57,30,"floor"],[57,37,57,35],[57,38,57,36,"i"],[57,39,57,37],[57,42,57,40,"wRatio"],[57,48,57,46],[57,49,57,47],[58,10,58,8],[58,16,58,14,"xx_stop"],[58,23,58,21],[58,26,58,24,"Math"],[58,30,58,28],[58,31,58,29,"ceil"],[58,35,58,33],[58,36,58,34],[58,37,58,35,"i"],[58,38,58,36],[58,41,58,39],[58,42,58,40],[58,46,58,44,"wRatio"],[58,52,58,50],[58,53,58,51],[59,10,59,8],[59,15,59,13],[59,19,59,17,"xx"],[59,21,59,19],[59,24,59,22,"xx_start"],[59,32,59,30],[59,34,59,32,"xx"],[59,36,59,34],[59,39,59,37,"xx_stop"],[59,46,59,44],[59,48,59,46,"xx"],[59,50,59,48],[59,52,59,50],[59,54,59,52],[60,12,60,10],[60,18,60,16,"dx"],[60,20,60,18],[60,23,60,21,"Math"],[60,27,60,25],[60,28,60,26,"abs"],[60,31,60,29],[60,32,60,30,"center_x"],[60,40,60,38],[60,44,60,42,"xx"],[60,46,60,44],[60,49,60,47],[60,52,60,50],[60,53,60,51],[60,54,60,52],[60,57,60,55,"wRatioHalf"],[60,67,60,65],[61,12,61,10],[61,18,61,16,"w"],[61,19,61,17],[61,22,61,20,"Math"],[61,26,61,24],[61,27,61,25,"sqrt"],[61,31,61,29],[61,32,61,30,"w0"],[61,34,61,32],[61,37,61,35,"dx"],[61,39,61,37],[61,42,61,40,"dx"],[61,44,61,42],[61,45,61,43],[62,12,62,10],[62,16,62,14,"w"],[62,17,62,15],[62,21,62,19],[62,22,62,20],[62,24,62,22],[63,14,63,12],[64,14,64,12],[65,12,65,10],[66,12,66,10],[67,12,67,10,"weight"],[67,18,67,16],[67,21,67,19],[67,22,67,20],[67,25,67,23,"w"],[67,26,67,24],[67,29,67,27,"w"],[67,30,67,28],[67,33,67,31,"w"],[67,34,67,32],[67,37,67,35],[67,38,67,36],[67,41,67,39,"w"],[67,42,67,40],[67,45,67,43,"w"],[67,46,67,44],[67,49,67,47],[67,50,67,48],[68,12,68,10],[68,18,68,16,"xPosition"],[68,27,68,25],[68,30,68,28],[68,31,68,29],[68,35,68,33,"xx"],[68,37,68,35],[68,40,68,38,"yy"],[68,42,68,40],[68,45,68,43,"widthSource"],[68,56,68,54],[68,57,68,55],[69,12,69,10],[70,12,70,10,"gx_a"],[70,16,70,14],[70,20,70,18,"weight"],[70,26,70,24],[70,29,70,27,"data"],[70,33,70,31],[70,34,70,32,"xPosition"],[70,43,70,41],[70,46,70,44],[70,47,70,45],[70,48,70,46],[71,12,71,10,"weightsAlpha"],[71,24,71,22],[71,28,71,26,"weight"],[71,34,71,32],[72,12,72,10],[73,12,73,10],[73,16,73,14,"data"],[73,20,73,18],[73,21,73,19,"xPosition"],[73,30,73,28],[73,33,73,31],[73,34,73,32],[73,35,73,33],[73,38,73,36],[73,41,73,39],[73,43,73,41],[74,14,74,12,"weight"],[74,20,74,18],[74,23,74,22,"weight"],[74,29,74,28],[74,32,74,31,"data"],[74,36,74,35],[74,37,74,36,"xPosition"],[74,46,74,45],[74,49,74,48],[74,50,74,49],[74,51,74,50],[74,54,74,54],[74,57,74,57],[75,12,75,10],[76,12,76,10,"gx_r"],[76,16,76,14],[76,20,76,18,"weight"],[76,26,76,24],[76,29,76,27,"data"],[76,33,76,31],[76,34,76,32,"xPosition"],[76,43,76,41],[76,44,76,42],[77,12,77,10,"gx_g"],[77,16,77,14],[77,20,77,18,"weight"],[77,26,77,24],[77,29,77,27,"data"],[77,33,77,31],[77,34,77,32,"xPosition"],[77,43,77,41],[77,46,77,44],[77,47,77,45],[77,48,77,46],[78,12,78,10,"gx_b"],[78,16,78,14],[78,20,78,18,"weight"],[78,26,78,24],[78,29,78,27,"data"],[78,33,78,31],[78,34,78,32,"xPosition"],[78,43,78,41],[78,46,78,44],[78,47,78,45],[78,48,78,46],[79,12,79,10,"weights"],[79,19,79,17],[79,23,79,21,"weight"],[79,29,79,27],[80,10,80,8],[81,8,81,6],[82,8,82,6,"data2"],[82,13,82,11],[82,14,82,12,"x2"],[82,16,82,14],[82,17,82,15],[82,20,82,18,"gx_r"],[82,24,82,22],[82,27,82,25,"weights"],[82,34,82,32],[83,8,83,6,"data2"],[83,13,83,11],[83,14,83,12,"x2"],[83,16,83,14],[83,19,83,17],[83,20,83,18],[83,21,83,19],[83,24,83,22,"gx_g"],[83,28,83,26],[83,31,83,29,"weights"],[83,38,83,36],[84,8,84,6,"data2"],[84,13,84,11],[84,14,84,12,"x2"],[84,16,84,14],[84,19,84,17],[84,20,84,18],[84,21,84,19],[84,24,84,22,"gx_b"],[84,28,84,26],[84,31,84,29,"weights"],[84,38,84,36],[85,8,85,6,"data2"],[85,13,85,11],[85,14,85,12,"x2"],[85,16,85,14],[85,19,85,17],[85,20,85,18],[85,21,85,19],[85,24,85,22,"gx_a"],[85,28,85,26],[85,31,85,29,"weightsAlpha"],[85,43,85,41],[86,6,86,4],[87,4,87,2],[89,4,89,2],[90,4,90,2],[90,8,90,6,"resizeCanvas"],[90,20,90,18],[90,22,90,20],[91,6,91,4,"result"],[91,12,91,10],[91,13,91,11,"width"],[91,18,91,16],[91,21,91,19,"width"],[91,26,91,24],[92,6,92,4,"result"],[92,12,92,10],[92,13,92,11,"height"],[92,19,92,17],[92,22,92,20,"height"],[92,28,92,26],[93,4,93,2],[95,4,95,2],[96,4,96,2],[96,10,96,8,"context"],[96,17,96,15],[96,20,96,18],[96,24,96,18,"getContext"],[96,33,96,28],[96,34,96,28,"getContext"],[96,44,96,28],[96,46,96,29,"result"],[96,52,96,35],[96,53,96,36],[97,4,97,2,"context"],[97,11,97,9],[97,12,97,10,"putImageData"],[97,24,97,22],[97,25,97,23,"img2"],[97,29,97,27],[97,31,97,29],[97,32,97,30],[97,34,97,32],[97,35,97,33],[97,36,97,34],[98,4,99,2],[98,11,99,9,"result"],[98,17,99,15],[99,2,100,0],[100,2,102,0],[100,6,102,0,"_default"],[100,14,102,0],[100,17,102,15,"_default"],[100,18,102,16,"canvas"],[100,24,102,41],[100,26,102,43],[101,4,102,45,"width"],[101,9,102,50],[102,4,102,52,"height"],[103,2,102,83],[103,3,102,84],[103,8,102,89],[104,4,103,2],[104,10,103,8,"imageRatio"],[104,20,103,18],[104,23,103,21,"canvas"],[104,29,103,27],[104,30,103,28,"width"],[104,35,103,33],[104,38,103,36,"canvas"],[104,44,103,42],[104,45,103,43,"height"],[104,51,103,49],[105,4,105,2],[105,8,105,6,"requestedWidth"],[105,22,105,28],[105,25,105,31],[105,26,105,32],[106,4,106,2],[106,8,106,6,"requestedHeight"],[106,23,106,29],[106,26,106,32],[106,27,106,33],[107,4,107,2],[107,8,107,6,"width"],[107,13,107,11],[107,18,107,16,"undefined"],[107,27,107,25],[107,29,107,27],[108,6,108,4,"requestedWidth"],[108,20,108,18],[108,23,108,21,"width"],[108,28,108,26],[109,6,109,4,"requestedHeight"],[109,21,109,19],[109,24,109,22,"requestedWidth"],[109,38,109,36],[109,41,109,39,"imageRatio"],[109,51,109,49],[110,4,110,2],[111,4,111,2],[111,8,111,6,"height"],[111,14,111,12],[111,19,111,17,"undefined"],[111,28,111,26],[111,30,111,28],[112,6,112,4,"requestedHeight"],[112,21,112,19],[112,24,112,22,"height"],[112,30,112,28],[113,6,113,4],[113,10,113,8,"requestedWidth"],[113,24,113,22],[113,29,113,27],[113,30,113,28],[113,32,113,30],[114,8,114,6,"requestedWidth"],[114,22,114,20],[114,25,114,23,"requestedHeight"],[114,40,114,38],[114,43,114,41,"imageRatio"],[114,53,114,51],[115,6,115,4],[116,4,116,2],[117,4,118,2],[117,11,118,9,"resampleSingle"],[117,25,118,23],[117,26,118,24,"canvas"],[117,32,118,30],[117,34,118,32,"requestedWidth"],[117,48,118,46],[117,50,118,48,"requestedHeight"],[117,65,118,63],[117,67,118,65],[117,71,118,69],[117,72,118,70],[118,2,119,0],[118,3,119,1],[119,0,119,2],[119,3]],"functionMap":{"names":["<global>","resampleSingle","default"],"mappings":"AAA;ACY;CDuF;eEE;CFiB"},"hasCjsExports":false},"type":"js/module"}]}