{"dependencies":[{"name":"expo","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":36,"index":36}}],"key":"PWvtvXU7MaET6Yd1Gn8oQOXJQ8A=","exportNames":["*"],"imports":1}},{"name":"./ImageManipulatorImageRef.web","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":118},"end":{"line":4,"column":70,"index":188}}],"key":"QQZbnSwpXLIftoWHZupzxzaCK6U=","exportNames":["*"],"imports":1}},{"name":"./actions/index.web","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":189},"end":{"line":5,"column":73,"index":262}}],"key":"U6OZJbqKaL+1PCYEnCSYGuR8Q6A=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return ImageManipulatorContext;\n    }\n  });\n  var _expo = require(_dependencyMap[0], \"expo\");\n  var _ImageManipulatorImageRefWeb = require(_dependencyMap[1], \"./ImageManipulatorImageRef.web\");\n  var ImageManipulatorImageRef = _interopDefault(_ImageManipulatorImageRefWeb);\n  var _actionsIndexWeb = require(_dependencyMap[2], \"./actions/index.web\");\n  class ImageManipulatorContext extends _expo.SharedObject {\n    get currentTask() {\n      if (this._currentTask) {\n        return this._currentTask;\n      }\n      this._currentTask = new Promise(resolve => resolve(this.loader()));\n      return this._currentTask;\n    }\n    set currentTask(task) {\n      this._currentTask = task;\n    }\n    constructor(loader) {\n      super();\n      this.loader = loader ?? (() => document.createElement('canvas'));\n    }\n    resize(size) {\n      return this.addTask(canvas => (0, _actionsIndexWeb.resize)(canvas, size));\n    }\n    rotate(degrees) {\n      return this.addTask(canvas => (0, _actionsIndexWeb.rotate)(canvas, degrees));\n    }\n    flip(flipType) {\n      return this.addTask(canvas => (0, _actionsIndexWeb.flip)(canvas, flipType));\n    }\n    crop(rect) {\n      return this.addTask(canvas => (0, _actionsIndexWeb.crop)(canvas, rect));\n    }\n    extent(options) {\n      return this.addTask(canvas => (0, _actionsIndexWeb.extent)(canvas, options));\n    }\n    reset() {\n      this.currentTask = new Promise(resolve => resolve(this.loader()));\n      return this;\n    }\n    async renderAsync() {\n      const canvas = await this.currentTask;\n\n      // We're copying the canvas so ref's `saveAsync` can safely use `toBlob` again with the desired format and quality.\n      // The original canvas cannot be reused as the manipulator context may still draw on it.\n      const clonedCanvas = document.createElement('canvas');\n      const clonedCanvasCtx = clonedCanvas.getContext('2d');\n      clonedCanvas.width = canvas.width;\n      clonedCanvas.height = canvas.height;\n      clonedCanvasCtx?.drawImage(canvas, 0, 0);\n      return new Promise(resolve => {\n        // Create a full-sized, full-quality blob from the original canvas.\n        canvas.toBlob(blob => {\n          const url = blob ? URL.createObjectURL(blob) : canvas.toDataURL();\n          const image = new ImageManipulatorImageRef.default(url, clonedCanvas);\n          resolve(image);\n        },\n        // Use PNG format so the result is of the best quality.\n        // If you need another format, see `saveAsync` function on the image ref.\n        'image/png');\n      });\n    }\n    addTask(task) {\n      this.currentTask = this.currentTask.then(canvas => {\n        return task(canvas);\n      });\n      return this;\n    }\n  }\n});","lineCount":85,"map":[[12,2,9,15,"Object"],[12,8,9,15],[12,9,9,15,"defineProperty"],[12,23,9,15],[12,24,9,15,"exports"],[12,31,9,15],[13,4,9,15,"enumerable"],[13,14,9,15],[14,4,9,15,"get"],[14,7,9,15],[14,18,9,15,"get"],[14,19,9,15],[15,6,9,15],[15,13,9,15,"ImageManipulatorContext"],[15,36,9,15],[16,4,9,15],[17,2,9,15],[18,2,1,0],[18,6,1,0,"_expo"],[18,11,1,0],[18,14,1,0,"require"],[18,21,1,0],[18,22,1,0,"_dependencyMap"],[18,36,1,0],[19,2,4,0],[19,6,4,0,"_ImageManipulatorImageRefWeb"],[19,34,4,0],[19,37,4,0,"require"],[19,44,4,0],[19,45,4,0,"_dependencyMap"],[19,59,4,0],[20,2,4,0],[20,6,4,0,"ImageManipulatorImageRef"],[20,30,4,0],[20,33,4,0,"_interopDefault"],[20,48,4,0],[20,49,4,0,"_ImageManipulatorImageRefWeb"],[20,77,4,0],[21,2,5,0],[21,6,5,0,"_actionsIndexWeb"],[21,22,5,0],[21,25,5,0,"require"],[21,32,5,0],[21,33,5,0,"_dependencyMap"],[21,47,5,0],[22,2,9,15],[22,8,9,21,"ImageManipulatorContext"],[22,31,9,44],[22,40,9,53,"SharedObject"],[22,45,9,65],[22,46,9,65,"SharedObject"],[22,58,9,65],[22,59,9,66],[23,4,13,2],[23,8,13,6,"currentTask"],[23,19,13,17,"currentTask"],[23,20,13,17],[23,22,13,20],[24,6,14,4],[24,10,14,8],[24,14,14,12],[24,15,14,13,"_currentTask"],[24,27,14,25],[24,29,14,27],[25,8,15,6],[25,15,15,13],[25,19,15,17],[25,20,15,18,"_currentTask"],[25,32,15,30],[26,6,16,4],[27,6,17,4],[27,10,17,8],[27,11,17,9,"_currentTask"],[27,23,17,21],[27,26,17,24],[27,30,17,28,"Promise"],[27,37,17,35],[27,38,17,37,"resolve"],[27,45,17,44],[27,49,17,49,"resolve"],[27,56,17,56],[27,57,17,57],[27,61,17,61],[27,62,17,62,"loader"],[27,68,17,68],[27,69,17,69],[27,70,17,70],[27,71,17,71],[27,72,17,72],[28,6,18,4],[28,13,18,11],[28,17,18,15],[28,18,18,16,"_currentTask"],[28,30,18,28],[29,4,19,2],[30,4,20,2],[30,8,20,6,"currentTask"],[30,19,20,17,"currentTask"],[30,20,20,18,"task"],[30,24,20,22],[30,26,20,24],[31,6,21,4],[31,10,21,8],[31,11,21,9,"_currentTask"],[31,23,21,21],[31,26,21,24,"task"],[31,30,21,28],[32,4,22,2],[33,4,24,2,"constructor"],[33,15,24,13,"constructor"],[33,16,24,14,"loader"],[33,22,24,36],[33,24,24,38],[34,6,25,4],[34,11,25,9],[34,12,25,10],[34,13,25,11],[35,6,26,4],[35,10,26,8],[35,11,26,9,"loader"],[35,17,26,15],[35,20,26,18,"loader"],[35,26,26,24],[35,31,26,29],[35,37,26,35,"document"],[35,45,26,43],[35,46,26,44,"createElement"],[35,59,26,57],[35,60,26,58],[35,68,26,66],[35,69,26,67],[35,70,26,68],[36,4,27,2],[37,4,29,2,"resize"],[37,10,29,8,"resize"],[37,11,29,9,"size"],[37,15,29,48],[37,17,29,75],[38,6,30,4],[38,13,30,11],[38,17,30,15],[38,18,30,16,"addTask"],[38,25,30,23],[38,26,30,25,"canvas"],[38,32,30,31],[38,36,30,36],[38,40,30,36,"resize"],[38,56,30,42],[38,57,30,42,"resize"],[38,63,30,42],[38,65,30,43,"canvas"],[38,71,30,49],[38,73,30,51,"size"],[38,77,30,55],[38,78,30,56],[38,79,30,57],[39,4,31,2],[40,4,33,2,"rotate"],[40,10,33,8,"rotate"],[40,11,33,9,"degrees"],[40,18,33,24],[40,20,33,51],[41,6,34,4],[41,13,34,11],[41,17,34,15],[41,18,34,16,"addTask"],[41,25,34,23],[41,26,34,25,"canvas"],[41,32,34,31],[41,36,34,36],[41,40,34,36,"rotate"],[41,56,34,42],[41,57,34,42,"rotate"],[41,63,34,42],[41,65,34,43,"canvas"],[41,71,34,49],[41,73,34,51,"degrees"],[41,80,34,58],[41,81,34,59],[41,82,34,60],[42,4,35,2],[43,4,37,2,"flip"],[43,8,37,6,"flip"],[43,9,37,7,"flipType"],[43,17,37,25],[43,19,37,52],[44,6,38,4],[44,13,38,11],[44,17,38,15],[44,18,38,16,"addTask"],[44,25,38,23],[44,26,38,25,"canvas"],[44,32,38,31],[44,36,38,36],[44,40,38,36,"flip"],[44,56,38,40],[44,57,38,40,"flip"],[44,61,38,40],[44,63,38,41,"canvas"],[44,69,38,47],[44,71,38,49,"flipType"],[44,79,38,57],[44,80,38,58],[44,81,38,59],[45,4,39,2],[46,4,41,2,"crop"],[46,8,41,6,"crop"],[46,9,41,7,"rect"],[46,13,41,31],[46,15,41,58],[47,6,42,4],[47,13,42,11],[47,17,42,15],[47,18,42,16,"addTask"],[47,25,42,23],[47,26,42,25,"canvas"],[47,32,42,31],[47,36,42,36],[47,40,42,36,"crop"],[47,56,42,40],[47,57,42,40,"crop"],[47,61,42,40],[47,63,42,41,"canvas"],[47,69,42,47],[47,71,42,49,"rect"],[47,75,42,53],[47,76,42,54],[47,77,42,55],[48,4,43,2],[49,4,45,2,"extent"],[49,10,45,8,"extent"],[49,11,45,9,"options"],[49,18,45,40],[49,20,45,67],[50,6,46,4],[50,13,46,11],[50,17,46,15],[50,18,46,16,"addTask"],[50,25,46,23],[50,26,46,25,"canvas"],[50,32,46,31],[50,36,46,36],[50,40,46,36,"extent"],[50,56,46,42],[50,57,46,42,"extent"],[50,63,46,42],[50,65,46,43,"canvas"],[50,71,46,49],[50,73,46,51,"options"],[50,80,46,58],[50,81,46,59],[50,82,46,60],[51,4,47,2],[52,4,49,2,"reset"],[52,9,49,7,"reset"],[52,10,49,7],[52,12,49,35],[53,6,50,4],[53,10,50,8],[53,11,50,9,"currentTask"],[53,22,50,20],[53,25,50,23],[53,29,50,27,"Promise"],[53,36,50,34],[53,37,50,36,"resolve"],[53,44,50,43],[53,48,50,48,"resolve"],[53,55,50,55],[53,56,50,56],[53,60,50,60],[53,61,50,61,"loader"],[53,67,50,67],[53,68,50,68],[53,69,50,69],[53,70,50,70],[53,71,50,71],[54,6,51,4],[54,13,51,11],[54,17,51,15],[55,4,52,2],[56,4,54,2],[56,10,54,8,"renderAsync"],[56,21,54,19,"renderAsync"],[56,22,54,19],[56,24,54,57],[57,6,55,4],[57,12,55,10,"canvas"],[57,18,55,16],[57,21,55,19],[57,27,55,25],[57,31,55,29],[57,32,55,30,"currentTask"],[57,43,55,41],[59,6,57,4],[60,6,58,4],[61,6,59,4],[61,12,59,10,"clonedCanvas"],[61,24,59,22],[61,27,59,25,"document"],[61,35,59,33],[61,36,59,34,"createElement"],[61,49,59,47],[61,50,59,48],[61,58,59,56],[61,59,59,57],[62,6,60,4],[62,12,60,10,"clonedCanvasCtx"],[62,27,60,25],[62,30,60,28,"clonedCanvas"],[62,42,60,40],[62,43,60,41,"getContext"],[62,53,60,51],[62,54,60,52],[62,58,60,56],[62,59,60,57],[63,6,62,4,"clonedCanvas"],[63,18,62,16],[63,19,62,17,"width"],[63,24,62,22],[63,27,62,25,"canvas"],[63,33,62,31],[63,34,62,32,"width"],[63,39,62,37],[64,6,63,4,"clonedCanvas"],[64,18,63,16],[64,19,63,17,"height"],[64,25,63,23],[64,28,63,26,"canvas"],[64,34,63,32],[64,35,63,33,"height"],[64,41,63,39],[65,6,64,4,"clonedCanvasCtx"],[65,21,64,19],[65,23,64,21,"drawImage"],[65,32,64,30],[65,33,64,31,"canvas"],[65,39,64,37],[65,41,64,39],[65,42,64,40],[65,44,64,42],[65,45,64,43],[65,46,64,44],[66,6,66,4],[66,13,66,11],[66,17,66,15,"Promise"],[66,24,66,22],[66,25,66,24,"resolve"],[66,32,66,31],[66,36,66,36],[67,8,67,6],[68,8,68,6,"canvas"],[68,14,68,12],[68,15,68,13,"toBlob"],[68,21,68,19],[68,22,69,9,"blob"],[68,26,69,13],[68,30,69,18],[69,10,70,10],[69,16,70,16,"url"],[69,19,70,19],[69,22,70,22,"blob"],[69,26,70,26],[69,29,70,29,"URL"],[69,32,70,32],[69,33,70,33,"createObjectURL"],[69,48,70,48],[69,49,70,49,"blob"],[69,53,70,53],[69,54,70,54],[69,57,70,57,"canvas"],[69,63,70,63],[69,64,70,64,"toDataURL"],[69,73,70,73],[69,74,70,74],[69,75,70,75],[70,10,71,10],[70,16,71,16,"image"],[70,21,71,21],[70,24,71,24],[70,28,71,28,"ImageManipulatorImageRef"],[70,52,71,52],[70,53,71,52,"default"],[70,60,71,52],[70,61,71,53,"url"],[70,64,71,56],[70,66,71,58,"clonedCanvas"],[70,78,71,70],[70,79,71,71],[71,10,73,10,"resolve"],[71,17,73,17],[71,18,73,18,"image"],[71,23,73,23],[71,24,73,24],[72,8,74,8],[72,9,74,9],[73,8,75,8],[74,8,76,8],[75,8,77,8],[75,19,78,6],[75,20,78,7],[76,6,79,4],[76,7,79,5],[76,8,79,6],[77,4,80,2],[78,4,82,10,"addTask"],[78,11,82,17,"addTask"],[78,12,83,4,"task"],[78,16,83,87],[78,18,84,29],[79,6,85,4],[79,10,85,8],[79,11,85,9,"currentTask"],[79,22,85,20],[79,25,85,23],[79,29,85,27],[79,30,85,28,"currentTask"],[79,41,85,39],[79,42,85,40,"then"],[79,46,85,44],[79,47,85,46,"canvas"],[79,53,85,52],[79,57,85,57],[80,8,86,6],[80,15,86,13,"task"],[80,19,86,17],[80,20,86,18,"canvas"],[80,26,86,24],[80,27,86,25],[81,6,87,4],[81,7,87,5],[81,8,87,6],[82,6,88,4],[82,13,88,11],[82,17,88,15],[83,4,89,2],[84,2,90,0],[85,0,90,1],[85,3]],"functionMap":{"names":["<global>","ImageManipulatorContext","get__currentTask","Promise$argument_0","set__currentTask","constructor","<anonymous>","resize","addTask$argument_0","rotate","flip","crop","extent","reset","renderAsync","canvas.toBlob$argument_0","addTask","currentTask.then$argument_0"],"mappings":"AAA;eCQ;ECI;oCCI,mCD;GDE;EGC;GHE;EIE;6BCE,sCD;GJC;EME;wBCC,gCD;GNC;EQE;wBDC,mCC;GRC;ESE;wBFC,kCE;GTC;EUE;wBHC,8BG;GVC;EWE;wBJC,mCI;GXC;EYE;mCVC,mCU;GZE;EaE;uBXY;QYG;SZK;KWK;GbC;EeE;6CCG;KDE;GfE;CDC"},"hasCjsExports":false},"type":"js/module"}]}